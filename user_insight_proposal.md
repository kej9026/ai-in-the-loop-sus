# 사용자 취향 분석 및 추천 시스템 제안

## 1. 개요
사용자의 축적된 감상 기록(Media Logs)을 분석하여 개인의 취향을 시각적으로 요약하고, 이를 바탕으로 새로운 콘텐츠를 추천하는 시스템에 대한 기획안입니다.

## 2. 사용자 취향 분석 (Visualization)
사용자가 "어떤 작품을 좋아하는지"를 한눈에 파악할 수 있는 대시보드 기능을 제안합니다.

### A. 선호 장르 분포 (Genre Distribution)
- **형태**: 도넛 차트 (Donut Chart) 또는 파이 차트
- **데이터**: `media_items`의 `genres` 필드 집계
- **인사이트**: "나는 SF와 스릴러를 주로 소비하는 사용자구나"를 인지

### B. 평점 성향 분석 (Rating Tendency)
- **형태**: 막대 그래프 (Bar Chart) - 1점부터 5점까지 분포
- **데이터**: `user_logs`의 `rating` 필드
- **인사이트**: 내가 점수를 후하게 주는 편인지, 깐깐하게 주는 편인지 파악

### C. 감성 키워드 워드 클라우드 (Mood Word Cloud)
- **형태**: 워드 클라우드 (Tag Cloud)
- **데이터**: `user_logs`에 저장된 AI 분석 `moods` 태그들
- **인사이트**: 장르만으로는 설명되지 않는 '분위기'(예: '철학적인', '우울한', '사이버펑크') 취향 파악

### D. 월별 감상 추이 (Monthly Activity)
- **형태**: 라인 차트 또는 히트맵 (Github Contribution 스타일)
- **데이터**: `user_logs`의 `end_date` 기준 월별 카운트
- **인사이트**: 나의 문화 생활 패턴 파악 (특정 시기에 많이 보는지 등)

---

## 3. 새로운 작품 추천 (Recommendation)
분석된 취향 데이터를 기반으로 "다음에 무엇을 볼까?"에 대한 해답을 제시합니다.

### A. AI 기반 개인화 추천 (Gemini Integration)
- **방식**: 최근 높게 평가한(4점 이상) 작품 5~10개의 제목과 감성 태그를 Gemini에게 프롬프트로 제공
- **프롬프트 예시**: "이 사용자는 '인셉션(철학, 꿈)', '다크 나이트(범죄, 느와르)'를 좋아해. 비슷한 분위기의 영화 3개만 추천해줘."
- **장점**: 문맥적인 추천이 가능하며, 단순 장르 매칭보다 정확도가 높음

### B. "놓친 명작" 발굴 (Discovery)
- **방식**: 외부 API (TMDB/RAWG)의 'Top Rated' 또는 'Trending' 리스트 중에서, 사용자가 선호하는 장르이면서 아직 보지 않은(DB에 없는) 작품을 필터링하여 노출
- **장점**: 데이터 기반의 객관적인 명작 추천

### C. 외부 API 연동 추천 (Similar/Related)
- **방식**: 사용자가 가장 최근에 5점을 준 작품의 ID를 이용해 `TMDB Get Similar Movies`나 `RAWG Get Suggested Games` API를 직접 호출
- **장점**: 외부 플랫폼의 추천 알고리즘을 그대로 활용 가능

### D. 미디어 믹스 확장 추천 (Cross-Media Expansion)
사용자가 즐긴 작품의 **원작**이나 **파생 작품**을 다른 미디어 형태(영화↔게임↔책)로 추천하여 콘텐츠 경험을 확장합니다.

**1. 식별 및 연결 전략 (Identification)**
- **AI 지식 기반 연결**: 별도의 메타데이터 없이 Gemini에게 질의.
    - 예: "게임 '위쳐 3: 와일드 헌트'의 원작 소설이나 드라마가 있어? 있다면 정확한 제목을 알려줘."
- **제목/키워드 매칭**: `The Last of Us` (Game) ↔ `The Last of Us` (TV Series/Movie) 처럼 제목이 정확히 일치하거나, 메타데이터의 `collections` 정보 활용.
- **API 태그 활용**: TMDB의 키워드(`based on video game`, `based on novel`)를 필터링하여 연결 고리 탐색.

**2. 추천 시나리오**
- **Game → Movie**: "플레이하신 '언차티드' 게임을 재밌게 하셨다면, 영화판 '언차티드'는 어떠신가요?"
- **Movie → Book**: "영화 '듄'의 세계관에 매료되셨나요? 원작 소설 '듄' 시리즈에 도전해보세요."
- **Book → Movie/Game**: "소설 '해리포터'를 읽으셨군요. 영화 시리즈 정주행이나 게임 '호그와트 레거시'를 추천합니다."

**3. UI/UX 확장성 (Future Proofing: Anime/Manga)**
- **유니버스 뷰 (Universe View)**: 상세 화면 하단에 `Media Universe` 섹션을 추가하여, 해당 작품과 연관된 다른 형태의 미디어들을 타임라인이나 관계도로 표시.
- **애니메이션/만화 확장**: 현재 3가지 타입(Movie, Game, Book) 외에 `Anime`, `Manga` 타입을 추가할 경우 로직을 그대로 재사용 가능 (원작 만화 ↔ 애니메이션 연결).

---

## 4. 기술적 구현 방안

### 라이브러리 선정
- **차트**: `recharts` (React/Next.js 생태계에서 가장 대중적이고 커스터마이징이 용이)
- **워드 클라우드**: `react-tagcloud` 또는 직접 CSS 구현

### 데이터 구조 고려사항
- 현재 `media_items` 테이블의 `metadata` 필드에 장르(genres) 등이 저장되어 있으므로, 이를 효율적으로 쿼리하거나 클라이언트에서 집계하는 로직이 필요합니다.
- 대시보드 로딩 속도 저하를 막기 위해, 통계 데이터는 별도 API 라우트에서 비동기로 가져오거나 React Server Component에서 페칭 후 캐싱하는 것이 좋습니다.

## 5. UI/UX 구조 및 네비게이션 전략
사용자 요청에 따라, 이 기능들을 기존 대시보드에 구겨 넣기보다는 **사이드바의 독립된 'Insights'(또는 취향 분석) 카테고리**로 분리하는 것을 권장합니다.

### A. 독립된 카테고리 선정 이유
1.  **정보의 성격 차이**: '라이브러리'는 기록과 관리(CRUD)가 목적이고, '인사이트'는 감상과 발견(Discovery)이 목적이므로 분리하는 것이 자연스럽습니다.
2.  **공간 확보**: 차트와 추천 리스트는 넓은 화면 공간을 필요로 합니다. 별도 페이지로 구성해야 시각적 답답함 없이 정보를 전달할 수 있습니다.
3.  **확장성**: 추후 '연말 결산(Wrapped)', '친구와 비교하기' 등의 기능이 추가될 때 유연하게 대처 가능합니다.

### B. 화면 레이아웃 제안 (Insights View)
새로운 `/insights` 페이지의 레이아웃 구성안입니다.

**1. 상단: 취향 요약 (Personal Identity)**
- "OOO님의 취향은 [철학적인] [SF] 매니아입니다." 같은 한 줄 요약 문구.
- 주요 키워드(가장 많이 본 장르, 총 감상 시간 등)를 뱃지 형태로 나열.

**2. 중단: 시각화 대시보드 (Visual Analytics)**
- **2열 그리드 레이아웃**:
    - **왼쪽**: 선호 장르 도넛 차트 + 평점 분포 막대 그래프.
    - **오른쪽**: 월별 활동 히트맵(잔디 심기) + 감성 키워드 워드 클라우드.

**3. 하단: 큐레이션 및 추천 (Discovery Section)**
- 탭(Tab) UI를 사용하여 여러 추천 로직을 전환.
    - **Tab 1: AI의 추천 편지**: Gemini가 작성한 개인화 추천 레터와 포스터 리스트.
    - **Tab 2: 놓친 명작**: 선호 장르의 Top Rated 미감상작.
    - **Tab 3: 미디어 유니버스**: 최근 본 작품의 원작/파생작 연결 고리.

## 6. 구현 계획 (Implementation Plan)

### Phase 1: 기본 구조 및 데이터 파이프라인 (Foundation)
- [ ] **라우팅 및 레이아웃**:
    - [ ] 사이드바에 `Insights` 메뉴 아이콘(예: `PieChart`) 추가
    - [ ] `/insights` 페이지 생성 및 기본 레이아웃(헤더, 그리드 컨테이너) 구성
- [ ] **데이터 페칭 로직**:
    - [ ] `app/actions/insights.ts` 생성: 통계용 데이터(장르 집계, 평점 분포 등)를 한 번에 가져오는 Server Action 구현 (`getInsightStats`)
    - [ ] React Query 또는 `useEffect`를 활용하여 클라이언트에서 데이터 로드 및 캐싱 처리

### Phase 2: 시각화 대시보드 (Visual Analytics)
- [ ] **라이브러리 세팅**: `recharts`, `react-tagcloud` 설치
- [ ] **장르/평점 차트**:
    - [ ] `GenreChart` 컴포넌트: 도넛 차트로 상위 5개 장르 시각화
    - [ ] `RatingChart` 컴포넌트: 1~5점 평점 분포 바 차트 시각화
- [ ] **감성 키워드 분석**:
    - [ ] `MoodCloud` 컴포넌트: `moods` 태그 빈도수 분석 및 워드 클라우드 렌더링
- [ ] **활동 히트맵**:
    - [ ] `ActivityHeatmap`: 월별/일별 감상 기록 히트맵(Github 스타일) 구현

### Phase 3: AI 및 추천 엔진 (Discovery Engine)
- [ ] **추천 탭 UI 구성**: 하단 영역에 탭(AI 추천, 놓친 명작, 유니버스) UI 구현
- [ ] **AI 추천 (Gemini)**:
    - [ ] `getPersonalizedRecommendations` Server Action 구현 (최근 감상작 기반 프롬프트 생성)
    - [ ] 추천 결과 표시용 카드 UI 및 로딩 스켈레톤 구현
- [ ] **유니버스 (Cross-Media)**:
    - [ ] 상세 화면 또는 추천 탭에 '연관 작품' 섹션 추가
    - [ ] 원작/파생작 탐색 로직 연결 (TMDB Collections, RAWG Series 등)

### Phase 4: 폴리싱 및 최적화
- [ ] **데이터 없을 때(Empty State)**: 기록이 부족한 초기 사용자를 위한 온보딩 UI ("작품을 5개 이상 평가하면 분석이 시작됩니다")
- [ ] **성능 최적화**: 차트 렌더링 최적화, 불필요한 API 재호출 방지
- [ ] **모바일 반응형 확인**: 작은 화면에서 차트가 깨지지 않는지 점검

